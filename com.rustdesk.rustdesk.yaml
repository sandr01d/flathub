app-id: com.rustdesk.rustdesk
runtime: org.freedesktop.Platform
runtime-version: "21.08"
sdk: org.freedesktop.Sdk
command: rustdesk

finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --socket=pulseaudio
  - --env=PATH=/app/bin:/usr/bin:/app/lib

modules:
  - name: xdotool
    buildsystem: simple
    build-commands:
      - PREFIX=/app make install
    sources:
      - type: git
        url: https://github.com/jordansissel/xdotool.git
  - name: rustdesk
    buildsystem: simple
    build-commands:
      - ./extract
      - install -Dm755 usr/bin/rustdesk /app/bin/rustdesk
      - install -Dm755 usr/lib/rustdesk/libsciter-gtk.so /app/lib/rustdesk/libsciter-gtk.so
      - install -Dm644 usr/share/icons/hicolor/32x32/apps/rustdesk.png /app/share/icons/hicolor/32x32/apps/com.rustdesk.rustdesk.png
      - install -Dm644 usr/share/icons/hicolor/128x128/apps/rustdesk.png /app/share/icons/hicolor/128x128/apps/com.rustdesk.rustdesk.png
      - install -Dm644 usr/share/icons/hicolor/256x256@2x/apps/rustdesk.png /app/share/icons/hicolor/256x256/apps/com.rustdesk.rustdesk.png
    sources:
      - type: file
        dest-filename: rustdesk.deb
        url: https://github.com/rustdesk/rustdesk/releases/download/1.1.9/rustdesk-1.1.9.deb
        sha256: 135e357e175c8681592ada1cecbb528364d3a6cd9863db55c1d10908beebbf47
        x-checker-data:
          type: json
          url: https://api.github.com/repos/rustdesk/rustdesk/releases/latest
          tag-query: .tag_name
          version-query: "$tag"
          timestamp-query: .published_at
          url-query: .assets[] | select(.name=="rustdesk-" + $version + ".deb") | .browser_download_url
      - type: script
        dest-filename: extract
        commands:
          - ar x rustdesk.deb
          - tar -xf data.tar.xz
          - rm -r rustdesk.deb control.tar.* data.tar.xz debian-binary usr/share/rustdesk